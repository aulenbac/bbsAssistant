---
title: "**bbsAssistant**: An R package for downloading and handling data and information from the North American Breeding Bird Survey."
date: "Last updated: `r Sys.Date()`"
bibliography: .github/paper/paper.bib
output: github_document
always_allow_html: true
---

<!-- badges: start -->
[![DOI](https://joss.theoj.org/papers/10.21105/joss.01768/status.svg?style=flat-square&logo=appveyor)](https://doi.org/10.21105/joss.01768)
[![lifecycle](https://img.shields.io/badge/lifecycle-maturing-lightgrey.svg?style=flat-square&logo=appveyor)](https://www.tidyverse.org/lifecycle/#maturing)
![usgs](https://img.shields.io/badge/USGS-Core-lightgrey.svg?style=flat-square&logo=appveyor)
[![R build status](https://github.com/trashbirdecology/bbsAssistant/workflows/R-CMD-check/badge.svg?style=flat-square&logo=appveyor)](https://github.com/trashbirdecology/bbsAssistant/actions)
[![License: CC0](https://img.shields.io/badge/License-CC0%201.0-lightgrey.svg?style=flat-square&logo=appveyor)](http://creativecommons.org/publicdomain/zero/1.0/)
[![Contributors](https://img.shields.io/badge/all_contributors-8-lightgrey.svg?style=flat-square&logo=appveyor)](#contributors)
<!-- ![downloads](https://img.shields.io/github/downloads/trashbirdecology/bbsAssistant/total?style=flat-square&logo=appveyor) -->
<!-- ![dependencies](https://img.shields.io/librariesio/github/trashbirdecology/bbsassistant?style=flat-square&logo=appveyor) -->
<!-- [![Travis build status](https://travis-ci.org/trashbirdecology/bbsAssistant.svg?branch=main)](https://travis-ci.org/trashbirdecology/bbsAssistant) -->
[![R-CMD-check](https://github.com/trashbirdecology/bbsAssistant/workflows/R-CMD-check/badge.svg)](https://github.com/trashbirdecology/bbsAssistant/actions)
<!-- badges: end -->
<img src=".github/figures/logo.png" align="right" height=140/>


## About
This repository contains the development version of __bbsAssistant__. Please submit [Issues here](https://github.com/TrashBirdEcology/bbsAssistant/issues). 

This package contains functions for downloading, importing, and (soon) visualizing the annual USGS release of the [North American Breeding Bird Survey](https://www.pwrc.usgs.gov/bbs/) (BBS) dataset [(retrieved from  USGS ScienceBase repository)](https://sciencebase.gov/). 

## Quick Start
```{r install, echo=FALSE, warning=FALSE, message=FALSE, eval=FALSE}
devtools::install_github("trashbirdecology/bbsAssistant", 
                         ref="feature-add", # change to 'main' for releases
                         # ref="main", # change to 'main' for releases
                         force=TRUE) # force=TRUE to get most recent dev version
```


```{r libs, echo=TRUE, warning=FALSE, message=FALSE, eval=TRUE}
library(bbsAssistant)
# view functions and data in package bbsAssistant
# ls("package:bbsAssistant")
```

## Download, Unpack, and Import the Most Recent Dataset
```{r grab_bbs_data, echo=TRUE, warning=FALSE, message=FALSE, eval=TRUE}
bbs_list <- grab_bbs_data()
# Optional: specify `sb_id` as the USGS ScienceBase identifier for a specific data release. If sb_id is not supplied, will default to the most recent data release.
```
The object resulting from `bbsAssistant::import_bbs_data()` is a list comprising the following elements:
```{r view, echo=TRUE, warning=FALSE, message=FALSE, eval=TRUE}
names(bbs)
```

## Filtering by State/Region
Filter the dataset `bbs` using your preferred method. A lookup table is provided as a package dataset for filtering by country or state using the BBS codes (see columns 'CountryNum' and 'StateNum') or ISO alpha codes and names (see columns 'iso_3155_2','iso_a2','name_fr','name_es'):
```{r regioncodes, echo=TRUE, warning=FALSE, message=FALSE, eval=TRUE}
bbsAssistant::region_codes
```
### Filter on species names
View the species lists for your particular dataset by calling:
```{r}
bbs$species_list
```

or view the most recent species list (may be the same as yours..):
```{r, eval=FALSE}
bbsAssistant::species_list
```

Keep only _Passer domesticus_:
```{r filter-hosp}
# grab the aou code for House Sparrow  using common name 
hosp.aou.code <- bbs$species_list$AOU[bbs$species_list$English_Common_Name=="House Sparrow"]
# or genus and species epithet
hosp.aou.code <-
  bbs$species_list$AOU[bbs$species_list$Genus == "Passer" &
                         bbs$species_list$Species == "domesticus"]

# filter the observations along  BBS's "AOU" code:
hosp.df <- munge_bbs_data(bbs_list, species = c("House SPARROW", "passer Domesticus",hosp.aou.code )) 
```

## BBS Data Availability (including sb_id)
There are currently two primary products released from the USGS that are derived from the annual BBS roadside surveys, the [observations data](https://www.sciencebase.gov/catalog/item/52b1dfa8e4b0d9b325230cd9) and the analysis results. The datasets (observations, results) are permanently and publicly available at [USGS ScienceBase](http://sciencebase.gov). 

The most recent annual releases of the observations and results datasets are stored as data objects in this package (see `data(bbs)`) will be downloaded as the default in this package, but the user has the option to specify historical dataset releases should they choose. Please see the function `get_bbs_data()`.

```{r dataset-lookup,  eval=TRUE, message=FALSE, warning=FALSE, echo=FALSE}
datasets <- bbsAssistant::sb_items
```
A lookup table containing the available datasets (N = `r length(unique(datasets$sb_item))`) and analysis results will be regularly updated, and comprises the following entries: 
```{r datasets, eval=TRUE, message=FALSE, warning=FALSE, echo=FALSE}
library(magrittr)
library(kableExtra)
library(dplyr)
datasets %>% select(-legacy_format, -sb_parent) %>%  
  relocate(sb_item, .after = last_col()) %>%
  kable(caption="List of datasets currently available for download at USGS ScienceBase. Highlighted and bold row indicates the default BBS observations dataset stored internally in the package.") %>% 
  kable_styling(bootstrap_options = "striped", full_width = TRUE, position = "left") %>% 
  column_spec(1, width = "100em") %>% 
  row_spec(1, background = "yellow", bold = TRUE)
```

## Citations
__For the BBS dataset and analysis results__, call `citation("bbsAssistant")` or see library loading message.

__For general use of the R package bbsAssistant__ and/or __companion paper__:  
Burnett, J.L., Wszola, L., and Palomo-Muñoz, G. (2019). bbsAssistant: An R package for downloading and handling data and information from the North American Breeding Bird Survey: U.S. Geological Survey software release, https://doi.org/10.5066/P93W0EAW.
_or_ 
Burnett, J.L., Wszola, L., and Palomo-Muñoz, G. (2019). bbsAssistant: An R package for downloading and handling data and information from the North American Breeding Bird Survey. Journal of Open Source Software, 4(44), 1768, https://doi.org/10.21105/joss.01768


## Contributing
To make a contribution visit  [CONTRIBUTIONS.md](https://github.com/trashbirdecology/bbsAssistant/CONTRIBUTING.md). Contributors __must adhere to the [Code of Conduct](https://github.com/trashbirdecology/bbsAssistant/CODE_OF_CONDUCT.md).__ For questions, comments, or issues, feel free to email the maintainer [Jessica Burnett](mailto:jburnett@usgs.gov) or submit an [Issue](https://github.com/TrashBirdEcology/bbsAssistant/issues) (preferred).
